<script>
 console.log('Script charg√©');
</script> 

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Types de Pr√™t</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div class="container mt-4">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fas fa-university me-2"></i>Gestion Pr√™ts</a>
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="index.html"><i class="fas fa-home me-1"></i>Accueil</a></li>
                <li class="nav-item"><a class="nav-link active" href="type_pret.html"><i class="fas fa-list-alt me-1"></i>Types de Pr√™t</a></li>
                <li class="nav-item"><a class="nav-link" href="ajout_fond.html"><i class="fas fa-money-bill-wave me-1"></i>Ajout de Fonds</a></li>
                <li class="nav-item"><a class="nav-link" href="liste_pret.html"><i class="fas fa-clipboard-list me-1"></i>Liste Pr√™ts/Demandes</a></li>
            </ul>
        </div>
    </nav>

    <h2 class="mb-4"><i class="fas fa-list-alt me-2"></i>Gestion des Types de Pr√™t</h2>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">Nouveau Type de Pr√™t</div>
                <div class="card-body">
                    <form id="typePretForm">
                        <div class="mb-3">
                            <label for="nomType" class="form-label">Nom</label>
                            <input type="text" class="form-control" id="nomType" required>
                        </div>
                        <div class="mb-3">
                            <label for="tauxBase" class="form-label">Taux de base (%)</label>
                            <input type="number" step="0.01" class="form-control" id="tauxBase" required>
                        </div>
                        <div class="mb-3">
                            <label for="tauxRisque" class="form-label">Taux de risque (%)</label>
                            <input type="number" step="0.01" class="form-control" id="tauxRisque" required>
                        </div>
                        <div class="mb-3">
                            <label for="dureeMax" class="form-label">Dur√©e maximale (mois)</label>
                            <input type="number" class="form-control" id="dureeMax" required>
                        </div>
                        <div class="mb-3">
                            <label for="montantMin" class="form-label">Montant minimum</label>
                            <input type="number" step="0.01" class="form-control" id="montantMin" required>
                        </div>
                        <div class="mb-3">
                            <label for="montantMax" class="form-label">Montant maximum</label>
                            <input type="number" step="0.01" class="form-control" id="montantMax" required>
                        </div>
                        <button type="submit" class="btn btn-success">Cr√©er</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info text-white">Liste des Types de Pr√™t</div>
                <div class="card-body">
                    <table class="table table-striped" id="tableTypesPret">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Taux Base (%)</th>
                                <th>Taux Risque (%)</th>
                                <th>Dur√©e max</th>
                                <th>Montant min</th>
                                <th>Montant max</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
  const apiBase = "/Exo/S4/ETU_3346_ETU_3351_ETU_3358/tp-flightphp-crud/ws";

  function ajax(method, url, data, callback) {
    const xhr = new XMLHttpRequest();
    xhr.open(method, apiBase + url, true);
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    xhr.onreadystatechange = () => {
      if (xhr.readyState === 4 && xhr.status === 200) {
        callback(JSON.parse(xhr.responseText));
      }
    };
    if (method === 'GET' || method === 'DELETE') {
        xhr.send();
    } else {
        xhr.send(data);
    }

  }

  function chargerTypesPret() {
    ajax("GET", "/types-pret", null, (data) => {
      const tbody = document.querySelector("#tableTypesPret tbody");
      tbody.innerHTML = "";
      data.forEach(type => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${type.nom}</td>
          <td>${type.taux_base}</td>
          <td>${type.taux_risque}</td>
          <td>${type.duree_max}</td>
          <td>${type.montant_min}</td>
          <td>${type.montant_max}</td>
          <td>
            <button onclick='supprimerTypePret(${type.id})'>üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    });
  }

  function ajouterTypePret() {
    const nom = document.getElementById("nomType").value;
    const taux_base = document.getElementById("tauxBase").value;
    const taux_risque = document.getElementById("tauxRisque").value;
    const duree_max = document.getElementById("dureeMax").value;
    const montant_min = document.getElementById("montantMin").value;
    const montant_max = document.getElementById("montantMax").value;

    const data = 
      `nom=${encodeURIComponent(nom)}&taux_base=${taux_base}&taux_risque=${taux_risque}` +
      `&duree_max=${duree_max}&montant_min=${montant_min}&montant_max=${montant_max}`;

    ajax("POST", "/types-pret", data, () => {
      resetForm();
      chargerTypesPret();
      alert("Type de pr√™t ajout√© avec succ√®s");
    });
  }

  function supprimerTypePret(id) {
    if (confirm("Supprimer ce type de pr√™t ?")) {
      ajax("DELETE", `/types-pret/${id}`, null, () => {
        chargerTypesPret();
        alert("Type de pr√™t supprim√© avec succ√®s");
      });
    }
  }

  function resetForm() {
    document.getElementById("nomType").value = "";
    document.getElementById("tauxBase").value = "";
    document.getElementById("tauxRisque").value = "";
    document.getElementById("dureeMax").value = "";
    document.getElementById("montantMin").value = "";
    document.getElementById("montantMax").value = "";
  }

  document.addEventListener("DOMContentLoaded", () => {
    chargerTypesPret();
    document.getElementById("typePretForm").addEventListener("submit", function(e) {
      e.preventDefault();
      ajouterTypePret();
    });
  });
</script>


</body>
</html>
